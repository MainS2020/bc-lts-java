

stages:
  - test
  - testAVX
  - testVAES
  - testVAESF
  - test11
  - test17
  - test21


test-java-code:
  stage: test
  script:
    - "ecr_login"
    - "ecr_pull vm_base_intel latest"
    - "ci_docker_run \"vm_base_intel:latest\" bc-lts-java  \"/workspace/bc-lts-java/ci/test_java.sh\""
  artifacts:
    when: always
    reports:
      junit:
      - "core/build/test-results"
      - "prov/build/test-results"
      - "jmail/build/test-results"
      - "pg/build/test-results"
      - "pkix/build/test-results"
      - "mail/build/test-results"
      - "util/build/test-results"
      - "tls/build/test-results"

test-code-avx:
  stage: testAVX
  script:
    - "ecr_login"
    - "ecr_pull vm_base_intel latest"
    - "ci_docker_run \"vm_base_intel:latest\" bc-lts-java \"/workspace/bc-lts-java/ci/test_avx.sh\""
  artifacts:
    when: always
    reports:
      junit:
        - "core/build/test-results"
        - "prov/build/test-results"
        - "jmail/build/test-results"
        - "pg/build/test-results"
        - "pkix/build/test-results"
        - "mail/build/test-results"
        - "util/build/test-results"
        - "tls/build/test-results"


test-code-vaes:
  stage: testVAES
  script:
    - "ecr_login"
    - "ecr_pull vm_base_intel latest"
    - "ci_docker_run \"vm_base_intel:latest\" bc-lts-java \"/workspace/bc-lts-java/ci/test_vaes.sh\""
  artifacts:
    when: always
    reports:
      junit:
        - "core/build/test-results"
        - "prov/build/test-results"
        - "jmail/build/test-results"
        - "pg/build/test-results"
        - "pkix/build/test-results"
        - "mail/build/test-results"
        - "util/build/test-results"
        - "tls/build/test-results"



test-code-vaesf:
  stage: testVAESF
  script:
    - "ecr_login"
    - "ecr_pull vm_base_intel latest"
    - "ci_docker_run \"vm_base_intel:latest\" bc-lts-java \"/workspace/bc-lts-java/ci/test_vaesf.sh\""
  artifacts:
    when: always
    reports:
      junit:
        - "core/build/test-results"
        - "prov/build/test-results"
        - "jmail/build/test-results"
        - "pg/build/test-results"
        - "pkix/build/test-results"
        - "mail/build/test-results"
        - "util/build/test-results"
        - "tls/build/test-results"


test-java11-code:
  stage: test11
  script:
    - "ecr_login"
    - "ecr_pull vm_base_intel latest"
    - "ci_docker_run \"vm_base_intel:latest\"  bc-lts-java \"/workspace/bc-lts-java/ci/test_jvms_11.sh\""

  artifacts:
    when: always
    reports:
      junit: build/artifacts/jdk11/reports/xml/**/TEST-*.xml


test-java17-code:
  stage: test17
  script:
    - "ecr_login"
    - "ecr_pull vm_base_intel latest"
    - "ci_docker_run \"vm_base_intel:latest\" bc-lts-java \"/workspace/bc-lts-java/ci/test_jvms_17.sh\""

  artifacts:
    when: always
    reports:
      junit: build/artifacts/jdk17/reports/xml/**/TEST-*.xml


test-java21-code:
  stage: test21
  script:
    - "ecr_login"
    - "ecr_pull vm_base_intel latest"
    - "ci_docker_run \"vm_base_intel:latest\" bc-lts-java \"/workspace/bc-lts-java/ci/test_jvms_21.sh\""

  artifacts:
    when: always
    reports:
      junit: build/artifacts/jdk21/reports/xml/**/TEST-*.xml
  

